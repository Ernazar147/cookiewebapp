<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tookie Cookie Shop</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" onerror="handleScriptError('Tailwind')">
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" onerror="handleScriptError('Tailwind backup')">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" onerror="handleScriptError('Tailwind cdnjs')">
    <script src="https://cdn.jsdelivr.net/npm/react@17.0.2/umd/react.production.min.js" onerror="handleScriptError('React')"></script>
    <script src="https://unpkg.com/react@17.0.2/umd/react.production.min.js" onerror="handleScriptError('React backup')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js" onerror="handleScriptError('React cdnjs')"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min.js" onerror="handleScriptError('ReactDOM')"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js" onerror="handleScriptError('ReactDOM backup')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js" onerror="handleScriptError('ReactDOM cdnjs')"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.6/babel.min.js" onerror="handleScriptError('Babel')"></script>
    <script src="https://unpkg.com/@babel/standalone@7.24.6/babel.min.js" onerror="handleScriptError('Babel backup')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.6/babel.min.js" onerror="handleScriptError('Babel cdnjs')"></script>
    <link rel="manifest" href="/manifest.json">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }
        .header-bg {
            background: linear-gradient(135deg, #f06292, #d81b60, #fce4ec);
            background-size: 200% 200%;
            animation: gradient 10s ease infinite;
            position: relative;
            overflow: hidden;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .emoji-bg {
            position: absolute;
            font-size: 50px;
            animation: float 15s infinite linear;
            opacity: 0.2;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100vh); }
        }
        .fly-to-cart {
            position: fixed;
            width: 80px;
            height: 80px;
            background-size: cover;
            z-index: 1002;
            animation: fly-to-cart 0.5s ease-out forwards;
        }
        @keyframes fly-to-cart {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.3) translate(150vw, 150vh); opacity: 0; }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.25); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .card-3d {
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .card-3d:hover {
            transform: perspective(1000px) rotateY(12deg) rotateX(12deg);
            box-shadow: 0 8px 16px rgba(216,27,96,0.8);
        }
        .loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: url('https://via.placeholder.com/60?text=üç™') no-repeat center;
            animation: spin 0.8s linear infinite;
            z-index: 1003;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-scale {
            animation: modalScale 0.3s ease-out;
        }
        @keyframes modalScale {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .cart-shake {
            animation: shake 0.3s ease-in-out;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #fce4ec;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #f06292;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #d81b60;
        }
        .rating-star {
            cursor: pointer;
            color: #d81b60;
        }
        .rating-star:hover, .rating-star.active {
            color: #f06292;
        }
        #error-message {
            display: none;
            text-align: center;
            padding: 40px;
            color: #d81b60;
            font-size: 20px;
            background: linear-gradient(135deg, #fce4ec, #f8bbd0);
            min-height: 100vh;
        }
        .draggable {
            cursor: move;
        }
        .share-btn {
            transition: transform 0.2s;
        }
        .share-btn:hover {
            transform: scale(1.1);
        }
        .carousel {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            display: flex;
            gap: 16px;
            padding: 16px;
            scroll-behavior: smooth;
        }
        .carousel-item {
            flex: 0 0 auto;
            scroll-snap-align: start;
        }
        .retry-btn {
            background: linear-gradient(to right, #f06292, #d81b60);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .retry-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="error-message">
        <h1>Tookie Cookie üç™</h1>
        <p id="error-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üòî –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
        <button class="retry-btn" onclick="window.location.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        <p>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.</p>
    </div>
    <div class="loader" id="loader"></div>

    <script>
        function handleScriptError(scriptName) {
            console.error(`${scriptName} failed to load!`);
            const errorText = document.getElementById("error-text");
            errorText.innerHTML = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${scriptName}! üòî –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN.<br>–¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.`;
            document.getElementById("error-message").style.display = "block";
            document.getElementById("root").style.display = "none";
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.showAlert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${scriptName}! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.`);
            }
        }
    </script>

    <script type="text/babel">
        console.log("Starting Tookie Cookie WebApp...");

        if (!window.React || !window.ReactDOM || !window.Babel) {
            console.error("React, ReactDOM, or Babel failed to load!");
            document.getElementById("error-text").innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ (React, ReactDOM –∏–ª–∏ Babel)! üòî –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN.<br>–¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.";
            document.getElementById("error-message").style.display = "block";
            document.getElementById("root").style.display = "none";
        } else {
            console.log("React, ReactDOM, and Babel loaded successfully!");
        }

        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        const TEXTS = {
            ru: {
                title: "Tookie Cookie üç™",
                all: "–í—Å–µ –ø–µ—á–µ–Ω—å—è",
                new: "–ù–æ–≤–∏–Ω–∫–∏",
                sets: "–ù–∞–±–æ—Ä—ã",
                popular: "–í—ã–±–æ—Ä –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π",
                orders: "–ó–∞–∫–∞–∑—ã",
                search: "–ü–æ–∏—Å–∫...",
                add: "–î–æ–±–∞–≤–∏—Ç—å",
                cart: "–ö–æ—Ä–∑–∏–Ω–∞",
                delivery: "–î–æ—Å—Ç–∞–≤–∫–∞ (+12%)",
                pickup: "–°–∞–º–æ–≤—ã–≤–æ–∑",
                total: "–ò—Ç–æ–≥–æ",
                confirm: "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑",
                quick_order: "–ë—ã—Å—Ç—Ä—ã–π –∑–∞–∫–∞–∑",
                profile: "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",
                name: "–ò–º—è",
                phone: "–¢–µ–ª–µ—Ñ–æ–Ω",
                location: "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è",
                edit: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",
                save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                get_location: "üìç –ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é",
                empty_cart: "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!",
                profile_updated: "–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!",
                profile_loaded: "–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Telegram!",
                profile_error: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram! –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.",
                invalid_name: "–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2-50 —Å–∏–º–≤–æ–ª–æ–≤!",
                invalid_phone: "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞!",
                loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
                no_orders: "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤!",
                filter_price: "–§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ",
                filter_rating: "–§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É",
                promo: "–ü—Ä–æ–º–æ–∫–æ–¥",
                apply_promo: "–ü—Ä–∏–º–µ–Ω–∏—Ç—å",
                invalid_promo: "–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥!",
                rating: "–û—Ü–µ–Ω–∏—Ç–µ —Ç–æ–≤–∞—Ä:",
                review: "–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤",
                submit_review: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤",
                share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
                analytics: {
                    added_to_cart: "–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É",
                    viewed: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ",
                    rated: "–û—Ü–µ–Ω–µ–Ω–æ",
                    reviewed: "–û—Ç–∑—ã–≤ –æ—Å—Ç–∞–≤–ª–µ–Ω"
                }
            },
            uz: {
                title: "Tookie Cookie üç™",
                all: "Barcha pechenyalar",
                new: "Yangiliklar",
                sets: "To'plamlar",
                popular: "Xaridorlar tanlovi",
                orders: "Buyurtmalar",
                search: "Qidirish...",
                add: "Qo'shish",
                cart: "Savat",
                delivery: "Yetkazib berish (+12%)",
                pickup: "O'z-o'zidan olib ketish",
                total: "Jami",
                confirm: "Buyurtmani rasmiylashtirish",
                quick_order: "Tezkor buyurtma",
                profile: "Profilingiz",
                name: "Ism",
                phone: "Telefon",
                location: "Geolokatsiya",
                edit: "Profilni tahrirlash",
                save: "Saqlash",
                get_location: "üìç Geolokatsiyani olish",
                empty_cart: "Savat bo'sh!",
                profile_updated: "Profil muvaffaqiyatli yangilandi!",
                profile_loaded: "Telegramdan profil ma'lumotlari yuklandi!",
                profile_error: "Telegramdan ma'lumotlarni yuklab bo'lmadi! Telegram-bot orqali oching.",
                invalid_name: "Ism 2-50 ta belgi bo'lishi kerak!",
                invalid_phone: "To'g'ri telefon raqamini kiriting!",
                loading: "Yuklanmoqda...",
                no_orders: "Sizda hali buyurtmalar yo'q!",
                filter_price: "Narx bo'yicha filtr",
                filter_rating: "Reyting bo'yicha filtr",
                promo: "Promokod",
                apply_promo: "Qo'llash",
                invalid_promo: "Noto'g'ri promokod!",
                rating: "Mahsulotni baholang:",
                review: "Fikr qoldiring",
                submit_review: "Fikr yuborish",
                share: "Ulashish",
                analytics: {
                    added_to_cart: "Savatga qo'shildi",
                    viewed: "Ko'rilgan",
                    rated: "Baholangan",
                    reviewed: "Fikr qoldirildi"
                }
            }
        };

        const cookies = [
            { id: 1, name: "–ö–ª–∞—Å—Å–∏–∫ –®–æ–∫–æ–ª–∞–¥", emoji: "üç´", price: 15000, oldPrice: 20000, category: "all popular", img: "https://via.placeholder.com/150?text=–®–æ–∫–æ–ª–∞–¥", description: { ru: "–ù–∞—Å—ã—â–µ–Ω–Ω–æ–µ —à–æ–∫–æ–ª–∞–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ —Å –∫—É—Å–æ—á–∫–∞–º–∏ –±–µ–ª—å–≥–∏–π—Å–∫–æ–≥–æ –∫–∞–∫–∞–æ", uz: "Belgiya kakao bo'laklari bilan to'yingan shokoladli pechenye" } },
            { id: 2, name: "–û—Ä–µ–æ-–ú–∞–Ω–∏—è", emoji: "üç™", price: 15000, oldPrice: 20000, category: "all new popular", img: "https://via.placeholder.com/150?text=–û—Ä–µ–æ", description: { ru: "–í–∞–Ω–∏–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–æ —Å –∫—Ä–æ—à–∫–∞–º–∏ Oreo –∏ –±–µ–ª—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º", uz: "Oreo bo'laklari va oq shokolad bilan vanil xamir" } },
            { id: 3, name: "–ö–ª—É–±–Ω–∏—á–Ω—ã–π –î–∂–µ–º", emoji: "üçì", price: 15000, oldPrice: 20000, category: "all new", img: "https://via.placeholder.com/150?text=–ö–ª—É–±–Ω–∏–∫–∞", description: { ru: "–ú—è–≥–∫–æ–µ –ø–µ—á–µ–Ω—å–µ —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ –∫–ª—É–±–Ω–∏—á–Ω–æ–≥–æ –¥–∂–µ–º–∞", uz: "Qulupnay murabbosi bilan yumshoq pechenye" } },
            { id: 4, name: "–ê—Ä–∞—Ö–∏—Å–æ–≤—ã–π –ë—É–º", emoji: "ü•ú", price: 15000, oldPrice: 20000, category: "all popular", img: "https://via.placeholder.com/150?text=–ê—Ä–∞—Ö–∏—Å", description: { ru: "–ê—Ä–∞—Ö–∏—Å–æ–≤–∞—è –ø–∞—Å—Ç–∞ + –∫–∞—Ä–∞–º–µ–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ä–µ—Ö", uz: "Yer yong'oq pastasi + karamelizatsiyalangan yong'oq" } },
            { id: 5, name: "–ú–µ–¥–æ–≤—ã–π –ù—É—Ç–µ–ª–ª–∞", emoji: "üçØ", price: 15000, oldPrice: 20000, category: "all new", img: "https://via.placeholder.com/150?text=–ù—É—Ç–µ–ª–ª–∞", description: { ru: "–¢—ë–ø–ª–æ–µ –ø–µ—á–µ–Ω—å–µ —Å –º–µ–¥–æ–º –∏ —Ü–µ–Ω—Ç—Ä–æ–º –∏–∑ Nutella", uz: "Asal va Nutella markazi bilan issiq pechenye" } },
            { id: 6, name: "–õ–∏–º–æ–Ω–Ω—ã–π –¢–∞—Ä—Ç", emoji: "üçã", price: 15000, oldPrice: 20000, category: "all", img: "https://via.placeholder.com/150?text=–õ–∏–º–æ–Ω", description: { ru: "–û—Å–≤–µ–∂–∞—é—â–µ–µ —Å–¥–æ–±–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ —Å —Ü–µ–¥—Ä–æ–π –ª–∏–º–æ–Ω–∞", uz: "Limon qobig'i bilan tetiklantiruvchi xamir pechenye" } },
            { id: 7, name: "–ë–∞–Ω–∞–Ω–æ–≤—ã–π –®—Ç–æ—Ä–º", emoji: "üçå", price: 15000, oldPrice: 20000, category: "all popular", img: "https://via.placeholder.com/150?text=–ë–∞–Ω–∞–Ω", description: { ru: "–ë–∞–Ω–∞–Ω–æ–≤–æ–µ —Ç–µ—Å—Ç–æ —Å —Ç—ë–º–Ω—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º", uz: "Qora shokolad bilan banan xamiri" } },
            { id: 8, name: "–ö—Ä–∞—Å–Ω—ã–π –ë–∞—Ä—Ö–∞—Ç", emoji: "ü•Æ", price: 15000, oldPrice: 20000, category: "all new", img: "https://via.placeholder.com/150?text=–ë–∞—Ä—Ö–∞—Ç", description: { ru: "–ö—Ä–∞—Å–Ω–æ–µ –≤–∞–Ω–∏–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–æ", uz: "Qizil vanil xamiri" } },
            { id: 9, name: "–ù–∞–±–æ—Ä 3 —à—Ç", emoji: "üéÅ", price: 45000, oldPrice: 60000, category: "all sets", img: "https://via.placeholder.com/150?text=–ù–∞–±–æ—Ä3", description: { ru: "–ê—Å—Å–æ—Ä—Ç–∏ –∏–∑ —Ç—Ä—ë—Ö –≤–∫—É—Å–æ–≤", uz: "Uchta ta'mdan iborat assorti" } },
            { id: 10, name: "–ù–∞–±–æ—Ä 6 —à—Ç", emoji: "üéÅ", price: 90000, oldPrice: 120000, category: "all sets", img: "https://via.placeholder.com/150?text=–ù–∞–±–æ—Ä6", description: { ru: "–ê—Å—Å–æ—Ä—Ç–∏ –∏–∑ —à–µ—Å—Ç–∏ –≤–∫—É—Å–æ–≤", uz: "Olti ta ta'mdan iborat assorti" } }
        ];

        const mockOrders = [
            { id: 1, date: "21.07.2025", items: [{ name: "–û—Ä–µ–æ-–ú–∞–Ω–∏—è", emoji: "üç™", quantity: 2, price: 15000, description: cookies[1].description }], total: 33600, delivery: "–î–æ—Å—Ç–∞–≤–∫–∞" },
            { id: 2, date: "20.07.2025", items: [{ name: "–ù–∞–±–æ—Ä 3 —à—Ç", emoji: "üéÅ", quantity: 1, price: 45000, description: cookies[8].description }], total: 45000, delivery: "–°–∞–º–æ–≤—ã–≤–æ–∑" }
        ];

        const App = () => {
            const [lang, setLang] = useState("ru");
            const [theme, setTheme] = useState("light");
            const [cart, setCart] = useState(JSON.parse(localStorage.getItem("cart")) || []);
            const [userData, setUserData] = useState(JSON.parse(localStorage.getItem("userData")) || { name: "–ì–æ—Å—Ç—å", phone: "+998901234567", location: "–ù–µ —É–∫–∞–∑–∞–Ω–∞" });
            const [activeTab, setActiveTab] = useState("all");
            const [search, setSearch] = useState("");
            const [priceFilter, setPriceFilter] = useState(null);
            const [ratingFilter, setRatingFilter] = useState(null);
            const [showProfileForm, setShowProfileForm] = useState(false);
            const [showCart, setShowCart] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [promoCode, setPromoCode] = useState("");
            const [promoDiscount, setPromoDiscount] = useState(0);
            const [ratings, setRatings] = useState(JSON.parse(localStorage.getItem("ratings")) || {});
            const [reviews, setReviews] = useState(JSON.parse(localStorage.getItem("reviews")) || {});
            const [analytics, setAnalytics] = useState(JSON.parse(localStorage.getItem("analytics")) || []);
            const cartRef = useRef(null);

            useEffect(() => {
                console.log("Initializing Tookie Cookie WebApp...");
                setIsLoading(true);

                const savedUserData = JSON.parse(localStorage.getItem("userData")) || {};
                let newUserData = {
                    name: savedUserData.name || "–ì–æ—Å—Ç—å",
                    phone: savedUserData.phone || "+998901234567",
                    location: savedUserData.location || "–ù–µ —É–∫–∞–∑–∞–Ω–∞"
                };

                if (window.Telegram && window.Telegram.WebApp) {
                    console.log("Running in Telegram WebApp environment");
                    Telegram.WebApp.ready();
                    const initData = Telegram.WebApp.initDataUnsafe || {};
                    const telegramUser = initData.user || {};
                    newUserData.name = telegramUser.first_name || newUserData.name;
                    newUserData.phone = telegramUser.phone_number || newUserData.phone;

                    if (!newUserData.location || newUserData.location === "–ù–µ —É–∫–∞–∑–∞–Ω–∞") {
                        if (Telegram.WebApp.requestLocation) {
                            Telegram.WebApp.requestLocation(location => {
                                if (location) {
                                    newUserData.location = `–®–∏—Ä–æ—Ç–∞: ${location.latitude}, –î–æ–ª–≥–æ—Ç–∞: ${location.longitude}`;
                                    setUserData(newUserData);
                                    localStorage.setItem("userData", JSON.stringify(newUserData));
                                    Telegram.WebApp.showAlert(TEXTS[lang].profile_loaded);
                                    console.log("Location received:", location);
                                } else {
                                    Telegram.WebApp.showAlert(TEXTS[lang].profile_error);
                                    console.error("Location request failed");
                                }
                                setIsLoading(false);
                            });
                        } else {
                            setUserData(newUserData);
                            localStorage.setItem("userData", JSON.stringify(newUserData));
                            Telegram.WebApp.showAlert(TEXTS[lang].profile_loaded);
                            setIsLoading(false);
                        }
                    } else {
                        setUserData(newUserData);
                        localStorage.setItem("userData", JSON.stringify(newUserData));
                        Telegram.WebApp.showAlert(TEXTS[lang].profile_loaded);
                        setIsLoading(false);
                    }
                } else {
                    console.warn("Not running in Telegram WebApp environment. Using fallback data.");
                    setUserData(newUserData);
                    localStorage.setItem("userData", JSON.stringify(newUserData));
                    document.getElementById("error-text").innerHTML = "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç! üòî –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.";
                    document.getElementById("error-message").style.display = "block";
                    setIsLoading(false);
                }

                if ("serviceWorker" in navigator) {
                    navigator.serviceWorker.register("/sw.js").then(reg => {
                        console.log("Service Worker registered:", reg);
                    }).catch(err => {
                        console.error("Service Worker failed:", err);
                        if (window.Telegram && window.Telegram.WebApp) {
                            Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker!");
                        }
                    });
                }

                return () => {};
            }, [lang]);

            useEffect(() => {
                localStorage.setItem("cart", JSON.stringify(cart));
                if (cartRef.current && cart.length > 0) {
                    cartRef.current.classList.add("cart-shake");
                    setTimeout(() => cartRef.current.classList.remove("cart-shake"), 300);
                }
            }, [cart]);

            useEffect(() => {
                localStorage.setItem("ratings", JSON.stringify(ratings));
            }, [ratings]);

            useEffect(() => {
                localStorage.setItem("reviews", JSON.stringify(reviews));
            }, [reviews]);

            useEffect(() => {
                localStorage.setItem("analytics", JSON.stringify(analytics));
            }, [analytics]);

            useEffect(() => {
                document.getElementById("loader").style.display = isLoading ? "block" : "none";
            }, [isLoading]);

            const toggleTheme = useCallback(() => {
                setTheme(theme === "light" ? "dark" : "light");
                console.log("Theme switched to:", theme === "light" ? "dark" : "light");
            }, [theme]);

            const switchLanguage = useCallback(() => {
                setLang(lang === "ru" ? "uz" : "ru");
                console.log("Language switched to:", lang === "ru" ? "uz" : "ru");
            }, [lang]);

            const addToCart = useCallback((cookieId, buttonRef) => {
                console.log("Adding to cart:", cookieId);
                const cookie = cookies.find(c => c.id === cookieId);
                setCart(prev => {
                    const cartItem = prev.find(item => item.id === cookieId);
                    if (cartItem) {
                        return prev.map(item => item.id === cookieId ? { ...item, quantity: item.quantity + 1 } : item);
                    }
                    return [...prev, { id: cookieId, name: cookie.name, emoji: cookie.emoji, price: cookie.price, quantity: 1, description: cookie.description[lang] }];
                });
                animateToCart(buttonRef, cookie.img);
                setAnalytics(prev => [...prev, { action: TEXTS[lang].analytics.added_to_cart, cookieId, timestamp: new Date().toISOString() }]);
            }, [lang]);

            const updateCartQuantity = useCallback((cookieId, delta) => {
                setCart(prev => {
                    const cartItem = prev.find(item => item.id === cookieId);
                    if (cartItem) {
                        const newQuantity = cartItem.quantity + delta;
                        if (newQuantity <= 0) {
                            return prev.filter(item => item.id !== cookieId);
                        }
                        return prev.map(item => item.id === cookieId ? { ...item, quantity: newQuantity } : item);
                    }
                    return prev;
                });
            }, []);

            const animateToCart = (button, imgSrc) => {
                const img = button.parentElement.querySelector("img");
                const cart = cartRef.current;
                const rect = img.getBoundingClientRect();
                const cartRect = cart.getBoundingClientRect();

                const flyingImg = document.createElement("div");
                flyingImg.className = "fly-to-cart";
                flyingImg.style.backgroundImage = `url(${imgSrc})`;
                flyingImg.style.left = `${rect.left}px`;
                flyingImg.style.top = `${rect.top}px`;
                document.body.appendChild(flyingImg);

                setTimeout(() => {
                    flyingImg.style.transform = `translate(${cartRect.left - rect.left}px, ${cartRect.top - rect.top}px) scale(0.3)`;
                    flyingImg.style.opacity = "0";
                }, 10);

                setTimeout(() => {
                    cart.classList.add("bounce");
                    setTimeout(() => cart.classList.remove("bounce"), 400);
                    flyingImg.remove();
                }, 500);
            };

            const toggleCart = useCallback((e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log("Cart toggled:", !showCart);
                setShowCart(prev => !prev);
            }, [showCart]);

            const applyPromo = useCallback(() => {
                console.log("Applying promo:", promoCode);
                if (promoCode === "TOOKI10") {
                    setPromoDiscount(0.1);
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].promo_applied || "–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!");
                    } else {
                        alert(TEXTS[lang].promo_applied || "–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!");
                    }
                } else {
                    setPromoDiscount(0);
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].invalid_promo);
                    } else {
                        alert(TEXTS[lang].invalid_promo);
                    }
                }
            }, [promoCode, lang]);

            const confirmOrder = useCallback(() => {
                if (cart.length === 0) {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].empty_cart);
                    } else {
                        alert(TEXTS[lang].empty_cart);
                    }
                    return;
                }
                setIsLoading(true);
                const deliveryType = document.querySelector('input[name="delivery"]:checked').value;
                let total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                if (deliveryType === "–î–æ—Å—Ç–∞–≤–∫–∞" || deliveryType === "Yetkazib berish") {
                    total = Math.round(total * 1.12);
                }
                total = Math.round(total * (1 - promoDiscount));
                const orderData = { action: "order", items: cart, delivery_type: deliveryType, total, promo: promoCode || null, user: userData };
                setTimeout(() => {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(orderData));
                        Telegram.WebApp.showAlert(TEXTS[lang].order_confirmed || "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!");
                    } else {
                        console.log("Order would be sent:", orderData);
                        alert(TEXTS[lang].order_confirmed || "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
                    }
                    setCart([]);
                    setPromoCode("");
                    setPromoDiscount(0);
                    setShowCart(false);
                    setIsLoading(false);
                    console.log("Order confirmed:", orderData);
                }, 500);
            }, [cart, promoCode, promoDiscount, userData, lang]);

            const quickOrder = useCallback(() => {
                if (cart.length === 0) {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].empty_cart);
                    } else {
                        alert(TEXTS[lang].empty_cart);
                    }
                    return;
                }
                setIsLoading(true);
                const deliveryType = "–°–∞–º–æ–≤—ã–≤–æ–∑";
                let total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                total = Math.round(total * (1 - promoDiscount));
                const orderData = { action: "order", items: cart, delivery_type: deliveryType, total, promo: promoCode || null, user: userData };
                setTimeout(() => {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(orderData));
                        Telegram.WebApp.showAlert(TEXTS[lang].order_confirmed || "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!");
                    } else {
                        console.log("Quick order would be sent:", orderData);
                        alert(TEXTS[lang].order_confirmed || "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
                    }
                    setCart([]);
                    setPromoCode("");
                    setPromoDiscount(0);
                    setShowCart(false);
                    setIsLoading(false);
                    console.log("Quick order confirmed:", orderData);
                }, 500);
            }, [cart, promoCode, promoDiscount, userData, lang]);

            const showEditProfile = useCallback(() => {
                setShowProfileForm(!showProfileForm);
                console.log("Profile form toggled:", !showProfileForm);
            }, [showProfileForm]);

            const requestLocation = useCallback(() => {
                if (window.Telegram && window.Telegram.WebApp && Telegram.WebApp.requestLocation) {
                    Telegram.WebApp.requestLocation(location => {
                        if (location) {
                            setUserData(prev => {
                                const newData = { ...prev, location: `–®–∏—Ä–æ—Ç–∞: ${location.latitude}, –î–æ–ª–≥–æ—Ç–∞: ${location.longitude}` };
                                localStorage.setItem("userData", JSON.stringify(newData));
                                return newData;
                            });
                            Telegram.WebApp.showAlert(TEXTS[lang].profile_updated);
                            console.log("Location received:", location);
                        } else {
                            Telegram.WebApp.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é!");
                            console.error("Location request failed");
                        }
                    });
                } else {
                    console.warn("Location API unavailable. Using fallback location.");
                    alert("–§—É–Ω–∫—Ü–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞! –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.");
                }
            }, [lang]);

            const saveProfile = useCallback(() => {
                const name = document.getElementById("edit-name").value || userData.name;
                const phone = document.getElementById("edit-phone").value || userData.phone;
                const location = document.getElementById("edit-location").value || userData.location;

                if (name.length < 2 || name.length > 50) {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].invalid_name);
                    } else {
                        alert(TEXTS[lang].invalid_name);
                    }
                    console.error("Invalid name:", name);
                    return;
                }
                if (!phone.match(/^\+?[1-9]\d{1,14}$/)) {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert(TEXTS[lang].invalid_phone);
                    } else {
                        alert(TEXTS[lang].invalid_phone);
                    }
                    console.error("Invalid phone:", phone);
                    return;
                }

                setIsLoading(true);
                setTimeout(() => {
                    const newUserData = { name, phone, location };
                    setUserData(newUserData);
                    localStorage.setItem("userData", JSON.stringify(newUserData));
                    setShowProfileForm(false);
                    if (window.Telegram && window.Telegram.WebApp) {
                        const profileData = { action: "update_profile", name, phone, location };
                        Telegram.WebApp.sendData(JSON.stringify(profileData));
                        Telegram.WebApp.showAlert(TEXTS[lang].profile_updated);
                    } else {
                        console.log("Profile would be updated:", newUserData);
                        alert(TEXTS[lang].profile_updated + " (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
                    }
                    setIsLoading(false);
                    console.log("Profile saved:", newUserData);
                }, 500);
            }, [userData, lang]);

            const setRating = useCallback((cookieId, rating) => {
                setRatings(prev => ({ ...prev, [cookieId]: rating }));
                setAnalytics(prev => [...prev, { action: TEXTS[lang].analytics.rated, cookieId, rating, timestamp: new Date().toISOString() }]);
                console.log("Rating set:", { cookieId, rating });
            }, [lang]);

            const submitReview = useCallback((cookieId, reviewText) => {
                if (reviewText.length < 5) {
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.showAlert("–û—Ç–∑—ã–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤!");
                    } else {
                        alert("–û—Ç–∑—ã–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤!");
                    }
                    return;
                }
                setReviews(prev => ({ ...prev, [cookieId]: [...(prev[cookieId] || []), { text: reviewText, timestamp: new Date().toISOString() }] }));
                setAnalytics(prev => [...prev, { action: TEXTS[lang].analytics.reviewed, cookieId, timestamp: new Date().toISOString() }]);
                if (window.Telegram && window.Telegram.WebApp) {
                    Telegram.WebApp.showAlert("–û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
                } else {
                    alert("–û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
                }
                console.log("Review submitted:", { cookieId, reviewText });
            }, [lang]);

            const shareCookie = useCallback((cookie) => {
                const shareUrl = `https://t.me/share/url?url=${encodeURIComponent("https://tookiecookie.github.io/shop")}&text=${encodeURIComponent(`–ü–æ–ø—Ä–æ–±—É–π ${cookie.name}! ${cookie.description[lang]} üç™`)}`;
                window.open(shareUrl, "_blank");
            }, [lang]);

            const debounce = (func, wait) => {
                let timeout;
                return (...args) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func(...args), wait);
                };
            };

            const debouncedSetSearch = debounce(setSearch, 300);
            const debouncedToggleCart = debounce(toggleCart, 200);

            const filteredCookies = useMemo(() => cookies.filter(cookie => 
                cookie.category.includes(activeTab) &&
                cookie.name.toLowerCase().includes(search.toLowerCase()) &&
                (!priceFilter || cookie.price <= priceFilter) &&
                (!ratingFilter || (ratings[cookie.id] || 0) >= ratingFilter)
            ), [activeTab, search, priceFilter, ratingFilter, ratings]);

            const newCookies = useMemo(() => cookies.filter(cookie => cookie.category.includes("new")), []);

            const CookieCard = React.memo(({ cookie, index }) => {
                const [reviewText, setReviewText] = useState("");

                const handleDragStart = (e) => {
                    e.dataTransfer.setData("cookieId", cookie.id);
                };

                return (
                    <div 
                        className="card-3d bg-white dark:bg-gray-800 rounded-lg p-4 shadow-lg transition-transform duration-300 draggable" 
                        style={{ animationDelay: `${index * 0.1}s` }}
                        draggable="true"
                        onDragStart={handleDragStart}
                    >
                        <img src={cookie.img} alt={cookie.name} className="w-full h-40 object-cover rounded-lg" loading="lazy" />
                        <h3 className="text-lg font-semibold text-pink-600 dark:text-pink-400">{cookie.emoji} {cookie.name}</h3>
                        <p className="text-sm text-gray-600 dark:text-gray-300">{cookie.description[lang]}</p>
                        <div className="text-pink-600 dark:text-pink-400 font-bold">{cookie.price} —Å—É–º</div>
                        <div className="text-gray-500 dark:text-gray-400 line-through text-sm">{cookie.oldPrice} —Å—É–º</div>
                        <div className="flex justify-center my-2">
                            {[...Array(5)].map((_, i) => (
                                <span
                                    key={i}
                                    className={`rating-star text-xl ${ratings[cookie.id] > i ? "active" : ""}`}
                                    onClick={() => setRating(cookie.id, i + 1)}
                                >
                                    ‚òÖ
                                </span>
                            ))}
                        </div>
                        <div className="mt-2">
                            <input
                                type="text"
                                placeholder={TEXTS[lang].review}
                                value={reviewText}
                                onChange={(e) => setReviewText(e.target.value)}
                                className="w-full p-2 mb-2 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                            />
                            <button
                                className="w-full bg-pink-400 text-white py-2 rounded-lg hover:bg-pink-500"
                                onClick={() => { submitReview(cookie.id, reviewText); setReviewText(""); }}
                            >
                                {TEXTS[lang].submit_review}
                            </button>
                        </div>
                        {(reviews[cookie.id] || []).map((review, i) => (
                            <p key={i} className="text-sm text-gray-600 dark:text-gray-300 mt-2"><b>–û—Ç–∑—ã–≤:</b> {review.text}</p>
                        ))}
                        <button
                            className="mt-2 w-full bg-gradient-to-r from-pink-400 to-pink-600 text-white py-2 rounded-lg hover:from-pink-500 hover:to-pink-700 share-btn"
                            onClick={() => shareCookie(cookie)}
                        >
                            {TEXTS[lang].share}
                        </button>
                        <button
                            className="mt-2 w-full bg-gradient-to-r from-pink-400 to-pink-600 text-white py-2 rounded-lg hover:from-pink-500 hover:to-pink-700"
                            onClick={(e) => addToCart(cookie.id, e.target)}
                        >
                            {TEXTS[lang].add}
                        </button>
                    </div>
                );
            });

            const handleDrop = useCallback((e) => {
                e.preventDefault();
                const cookieId = parseInt(e.dataTransfer.getData("cookieId"));
                addToCart(cookieId, cartRef.current);
            }, [addToCart]);

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            return (
                <div className={`min-h-screen ${theme === "dark" ? "dark bg-gray-900 text-white" : "bg-pink-100 text-gray-900"}`}>
                    <div className="fixed top-4 right-4 z-50">
                        <button onClick={switchLanguage} className="bg-pink-400 text-white px-4 py-2 rounded-lg mr-2 hover:bg-pink-500">
                            üá∑üá∫/üá∫üáø
                        </button>
                        <button onClick={toggleTheme} className="bg-pink-400 text-white px-4 py-2 rounded-lg hover:bg-pink-500">
                            {theme === "light" ? "üåô" : "‚òÄÔ∏è"}
                        </button>
                    </div>
                    <div className="header-bg py-8 relative">
                        <h1 className="text-4xl font-bold text-center text-white mb-6 fade-in">{TEXTS[lang].title}</h1>
                        <div className="emoji-bg" style={{ left: '10%', top: '100%' }}>üç™</div>
                        <div className="emoji-bg" style={{ left: '30%', top: '120%' }}>üç´</div>
                        <div className="emoji-bg" style={{ left: '50%', top: '150%' }}>üçì</div>
                        <div className="emoji-bg" style={{ left: '70%', top: '180%' }}>ü•ú</div>
                        <div className="emoji-bg" style={{ left: '90%', top: '200%' }}>üçØ</div>
                    </div>
                    <div className="container mx-auto px-4 py-8">
                        <div className="bg-orange-100 dark:bg-gray-800 rounded-lg p-6 mb-6 shadow-md fade-in custom-scrollbar">
                            <h2 className="text-xl font-semibold text-pink-600 dark:text-pink-400">{TEXTS[lang].profile}</h2>
                            <p><b>{TEXTS[lang].name}:</b> {userData.name}</p>
                            <p><b>{TEXTS[lang].phone}:</b> {userData.phone}</p>
                            <p><b>{TEXTS[lang].location}:</b> {userData.location}</p>
                            <button
                                className="mt-4 w-full bg-pink-400 text-white py-2 rounded-lg hover:bg-pink-500"
                                onClick={showEditProfile}
                            >
                                {TEXTS[lang].edit}
                            </button>
                            {showProfileForm &&
                                <div className="mt-4 fade-in">
                                    <input
                                        id="edit-name"
                                        type="text"
                                        defaultValue={userData.name}
                                        placeholder={TEXTS[lang].name}
                                        className="w-full p-2 mb-2 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                    />
                                    <input
                                        id="edit-phone"
                                        type="text"
                                        defaultValue={userData.phone}
                                        placeholder={TEXTS[lang].phone}
                                        className="w-full p-2 mb-2 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                    />
                                    <input
                                        id="edit-location"
                                        type="text"
                                        defaultValue={userData.location}
                                        placeholder={TEXTS[lang].location}
                                        className="w-full p-2 mb-2 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                    />
                                    <button
                                        className="w-full bg-pink-400 text-white py-2 rounded-lg mb-2 hover:bg-pink-500"
                                        onClick={requestLocation}
                                    >
                                        {TEXTS[lang].get_location}
                                    </button>
                                    <button
                                        className="w-full bg-pink-600 text-white py-2 rounded-lg hover:bg-pink-700"
                                        onClick={saveProfile}
                                    >
                                        {TEXTS[lang].save}
                                    </button>
                                </div>
                            }
                        </div>

                        <div className="mb-6 fade-in">
                            <h2 className="text-xl font-semibold text-pink-600 dark:text-pink-400">{TEXTS[lang].new}</h2>
                            <div className="carousel custom-scrollbar">
                                {newCookies.map((cookie, index) => (
                                    <div key={cookie.id} className="carousel-item card-3d bg-white dark:bg-gray-800 rounded-lg p-4 shadow-lg" style={{ width: '200px', animationDelay: `${index * 0.1}s` }}>
                                        <img src={cookie.img} alt={cookie.name} className="w-full h-32 object-cover rounded-lg" loading="lazy" />
                                        <h3 className="text-md font-semibold text-pink-600 dark:text-pink-400">{cookie.emoji} {cookie.name}</h3>
                                        <div className="text-pink-600 dark:text-pink-400 font-bold">{cookie.price} —Å—É–º</div>
                                        <button
                                            className="mt-2 w-full bg-gradient-to-r from-pink-400 to-pink-600 text-white py-1 rounded-lg hover:from-pink-500 hover:to-pink-700"
                                            onClick={(e) => addToCart(cookie.id, e.target)}
                                        >
                                            {TEXTS[lang].add}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="flex justify-around bg-gradient-to-r from-pink-400 to-pink-600 rounded-lg p-2 mb-6 sticky top-0 z-10 fade-in">
                            {["all", "new", "sets", "popular", "orders"].map(tab => (
                                <button
                                    key={tab}
                                    className={`flex-1 py-3 rounded-lg text-white font-semibold ${activeTab === tab ? "bg-pink-700" : "hover:bg-pink-500"}`}
                                    onClick={() => setActiveTab(tab)}
                                >
                                    {TEXTS[lang][tab]}
                                </button>
                            ))}
                        </div>

                        {activeTab !== "orders" &&
                            <div className="mb-6 fade-in">
                                <input
                                    type="text"
                                    placeholder={TEXTS[lang].search}
                                    onChange={(e) => debouncedSetSearch(e.target.value)}
                                    className="w-full p-3 mb-4 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                />
                                <select
                                    onChange={(e) => setPriceFilter(e.target.value ? Number(e.target.value) : null)}
                                    className="w-full p-3 mb-4 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                >
                                    <option value="">{TEXTS[lang].filter_price}</option>
                                    <option value="15000">–î–æ 15000 —Å—É–º</option>
                                    <option value="50000">–î–æ 50000 —Å—É–º</option>
                                    <option value="100000">–î–æ 100000 —Å—É–º</option>
                                </select>
                                <select
                                    onChange={(e) => setRatingFilter(e.target.value ? Number(e.target.value) : null)}
                                    className="w-full p-3 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                >
                                    <option value="">{TEXTS[lang].filter_rating}</option>
                                    <option value="1">‚òÖ –∏ –≤—ã—à–µ</option>
                                    <option value="2">‚òÖ‚òÖ –∏ –≤—ã—à–µ</option>
                                    <option value="3">‚òÖ‚òÖ‚òÖ –∏ –≤—ã—à–µ</option>
                                    <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ –∏ –≤—ã—à–µ</option>
                                    <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
                                </select>
                            </div>
                        }

                        {activeTab !== "orders" ? (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 custom-scrollbar" style={{ maxHeight: '500px', overflowY: 'auto' }}>
                                {filteredCookies.map((cookie, index) => (
                                    <CookieCard key={cookie.id} cookie={cookie} index={index} />
                                ))}
                            </div>
                        ) : (
                            <div className="fade-in custom-scrollbar" style={{ maxHeight: '500px', overflowY: 'auto' }}>
                                {mockOrders.length === 0 ? (
                                    <p>{TEXTS[lang].no_orders}</p>
                                ) : (
                                    mockOrders.map(order => (
                                        <div key={order.id} className="bg-white dark:bg-gray-800 rounded-lg p-4 mb-4 shadow-md fade-in">
                                            <p><b>–ó–∞–∫–∞–∑ ‚Ññ{order.id}</b> ({order.date})</p>
                                            {order.items.map(item => (
                                                <p key={item.name}>{item.emoji} {item.name} ({item.quantity} x {item.price} —Å—É–º)<br/><small>{item.description[lang]}</small></p>
                                            ))}
                                            <p><b>{TEXTS[lang].total}:</b> {order.total} —Å—É–º ({order.delivery})</p>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        <div
                            ref={cartRef}
                            id="cart"
                            className="fixed bottom-4 right-4 bg-gradient-to-r from-pink-400 to-pink-600 text-white p-4 rounded-full shadow-lg cursor-pointer z-[1003]"
                            onDrop={handleDrop}
                            onDragOver={handleDragOver}
                            onClick={debouncedToggleCart}
                        >
                            üõí <span className="absolute -top-2 -right-2 bg-pink-700 rounded-full px-2 py-1 text-sm">{cart.reduce((sum, item) => sum + item.quantity, 0)}</span>
                        </div>
                        {showCart &&
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1003] modal-scale">
                                <div className="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[80vh] overflow-y-auto custom-scrollbar">
                                    <h3 className="text-xl font-semibold text-pink-600 dark:text-pink-400">{TEXTS[lang].cart}</h3>
                                    {cart.length === 0 ? (
                                        <p>{TEXTS[lang].empty_cart}</p>
                                    ) : (
                                        cart.map(item => (
                                            <div key={item.id} className="flex justify-between items-center mb-2">
                                                <span>{item.emoji} {item.name} ({item.quantity} x {item.price} —Å—É–º)<br/><small>{item.description}</small></span>
                                                <div className="flex items-center">
                                                    <button
                                                        className="bg-pink-400 text-white px-2 py-1 rounded hover:bg-pink-500"
                                                        onClick={() => updateCartQuantity(item.id, -1)}
                                                    >
                                                        -
                                                    </button>
                                                    <span className="mx-2">{item.quantity}</span>
                                                    <button
                                                        className="bg-pink-400 text-white px-2 py-1 rounded hover:bg-pink-500"
                                                        onClick={() => updateCartQuantity(item.id, 1)}
                                                    >
                                                        +
                                                    </button>
                                                    <button
                                                        className="bg-pink-600 text-white px-2 py-1 rounded hover:bg-pink-700 ml-2"
                                                        onClick={() => updateCartQuantity(item.id, -item.quantity)}
                                                    >
                                                        ‚ùå
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                    <div className="my-4">
                                        <label className="mr-4 text-pink-600 dark:text-pink-400">
                                            <input type="radio" name="delivery" value="–î–æ—Å—Ç–∞–≤–∫–∞" defaultChecked /> {TEXTS[lang].delivery}
                                        </label>
                                        <label className="text-pink-600 dark:text-pink-400">
                                            <input type="radio" name="delivery" value="–°–∞–º–æ–≤—ã–≤–æ–∑" /> {TEXTS[lang].pickup}
                                        </label>
                                    </div>
                                    <div className="my-4">
                                        <input
                                            type="text"
                                            placeholder={TEXTS[lang].promo}
                                            value={promoCode}
                                            onChange={(e) => setPromoCode(e.target.value)}
                                            className="w-full p-2 mb-2 border border-pink-400 rounded-lg dark:bg-gray-700 dark:text-white"
                                        />
                                        <button
                                            className="w-full bg-pink-400 text-white py-2 rounded-lg hover:bg-pink-500"
                                            onClick={applyPromo}
                                        >
                                            {TEXTS[lang].apply_promo}
                                        </button>
                                    </div>
                                    <div>
                                        <b>{TEXTS[lang].total}:</b> <span>
                                            {Math.round(cart.reduce((sum, item) => sum + item.price * item.quantity, 0) * 
                                            (document.querySelector('input[name="delivery"]:checked').value === "–î–æ—Å—Ç–∞–≤–∫–∞" ? 1.12 : 1) * 
                                            (1 - promoDiscount))} —Å—É–º
                                        </span>
                                    </div>
                                    <button
                                        className="w-full bg-gradient-to-r from-pink-600 to-pink-800 text-white py-3 rounded-lg mt-4 hover:from-pink-700 hover:to-pink-900"
                                        onClick={confirmOrder}
                                    >
                                        {TEXTS[lang].confirm}
                                    </button>
                                    <button
                                        className="w-full bg-gradient-to-r from-pink-400 to-pink-600 text-white py-3 rounded-lg mt-2 hover:from-pink-500 hover:to-pink-700"
                                        onClick={quickOrder}
                                    >
                                        {TEXTS[lang].quick_order}
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            );
        };

        try {
            ReactDOM.render(<App />, document.getElementById("root"));
            console.log("App rendered successfully!");
        } catch (e) {
            console.error("Render failed:", e);
            document.getElementById("error-text").innerHTML = "–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üòî –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12).";
            document.getElementById("error-message").style.display = "block";
            document.getElementById("root").style.display = "none";
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç.");
            }
        }
    </script>

    <script type="application/json" id="manifest">
        {
            "name": "Tookie Cookie Shop",
            "short_name": "Tookie Cookie",
            "start_url": "/shop",
            "display": "standalone",
            "background_color": "#fce4ec",
            "theme_color": "#f06292",
            "icons": [
                {
                    "src": "https://via.placeholder.com/192?text=üç™",
                    "sizes": "192x192",
                    "type": "image/png"
                }
            ]
        }
    </script>
</body>
</html>